---
# yaml-language-server: $schema=https://kubernetes-schemas.ok8.sh/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: copyparty
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword-connect
  target:
    name: copyparty-secret
    template:
      data:
        config.conf: |
          [global]
            p: 8086, 3923
            ed2dsa # File Indexing & Scanning
            e2ts # Mulitimedia Indexing
            z, qr # Zeroconf & QRCode'

          [accounts]
            kashall: {{ .password }}

          [/]         # create a volume at "/" (the webroot), which will
            /w         # share the contents of "." (the current directory)
            accs:
              rw: kashall

          [/dump]
            /w/dump
            accs:
              w: *
            flags:
              e2d # Enables uploads
              nodupe # Reject duplicate
  dataFrom:
    - extract:
        key: copyparty
