version: v1alpha1
debug: false
persist: true
machine:
  type: controlplane
  token: moq01v.5yancvxb7k6veqas

  ca:
    crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJQakNCOGFBREFnRUNBaEJiVzRiMGRCY1lUQmhMWkZlNU43QlBNQVVHQXl0bGNEQVFNUTR3REFZRFZRUUsKRXdWMFlXeHZjekFlRncweU5ERXhNakl3TWpVNE5UZGFGdzB6TkRFeE1qQXdNalU0TlRkYU1CQXhEakFNQmdOVgpCQW9UQlhSaGJHOXpNQ293QlFZREsyVndBeUVBeGkwMm9nc0FaR0tXdGw1Nmw0dkRRdU8xMzNkTXU1NDRIb04zCnRwZnVDNldqWVRCZk1BNEdBMVVkRHdFQi93UUVBd0lDaERBZEJnTlZIU1VFRmpBVUJnZ3JCZ0VGQlFjREFRWUkKS3dZQkJRVUhBd0l3RHdZRFZSMFRBUUgvQkFVd0F3RUIvekFkQmdOVkhRNEVGZ1FVQjRreWN2OEFTZ3A0bnJ3ZQo5MzlPNWNKRzQrWXdCUVlESzJWd0EwRUFvRU96NHA0TGovYU5qOWk2aVIwL1c4K0RyQmljSWp4NzRBMm9nRnF4CituR2lsS1VIdUtJaTVDWC9LVVVjUm42VVpZcnlYQm1OU0I2eFhkK2VBbFcxRHc9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
    key: LS0tLS1CRUdJTiBFRDI1NTE5IFBSSVZBVEUgS0VZLS0tLS0KTUM0Q0FRQXdCUVlESzJWd0JDSUVJRm5zR3VOaE5yTHZRRkhTRy9BSHhsUTM4aDRtZGh4Y2hrcUtoOWFQa0MzcAotLS0tLUVORCBFRDI1NTE5IFBSSVZBVEUgS0VZLS0tLS0K

  certSANs:
    - 127.0.0.1
    - 172.16.0.3

  kubelet:
    image: ghcr.io/siderolabs/kubelet:${KUBERNETES_VERSION}
    defaultRuntimeSeccompProfileEnabled: true
    disableManifestsDirectory: true
    extraArgs:
      image-gc-high-threshold: "55"
      image-gc-low-threshold: "50"
      rotate-server-certificates: "true"
    extraMounts:
      - destination: /var/openebs/local
        source: /var/openebs/local
        type: bind
        options:
          - bind
          - rshared
          - rw
    nodeIP:
      validSubnets:
        - 172.16.0.0/24

  network:
    hostname: fran
    interfaces:
      - dhcp: true
        deviceSelector:
          hardwareAddr: 7c:fe:90:19:f5:00

  install:
    disk: /dev/sda
    image: factory.talos.dev/installer/${TALOS_SCHEMATIC_ID}:${TALOS_VERSION}
    wipe: false

  features:
    rbac: true
    stableHostname: true
    apidCheckExtKeyUsage: true
    diskQuotaSupport: true
    kubePrism:
      enabled: true
      port: 7445
    hostDNS:
      enabled: true
      resolveMemberNames: true
      forwardKubeDNSToHost: false
    kubernetesTalosAPIAccess:
      enabled: true
      allowedRoles:
        - os:admin
      allowedKubernetesNamespaces:
        - system-upgrade

  files:
    - content: |-
        [plugins."io.containerd.grpc.v1.cri"]
          enable_unprivileged_ports = true
          enable_unprivileged_icmp = true
        [plugins."io.containerd.grpc.v1.cri".containerd]
          discard_unpacked_layers = false
        [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
          discard_unpacked_layers = false
      permissions: 0
      path: /etc/cri/conf.d/20-customization.part
      op: create
    - content: |-
        [ NFSMount_Global_Options ]
        nfsvers=4.2
        hard=True
        noatime=True
        nodiratime=True
        rsize=131072
        wsize=131072
        nconnect=8
      permissions: 420
      path: /etc/nfsmount.conf
      op: overwrite
  sysctls:
    fs.inotify.max_queued_events: "65536"
    fs.inotify.max_user_instances: "8192"
    fs.inotify.max_user_watches: "524288"
    net.core.rmem_max: "7500000"
    net.core.wmem_max: "7500000"
    net.ipv6.conf.enp2s0f0.accept_ra: "2"
  udev:
    rules:
      - SUBSYSTEM=="drm", KERNEL=="renderD*", GROUP="44", MODE="0660"

cluster:
  id: B5aNm3Y67NHeW_aZT_IXeqmZ0vA28E4ZPvxLu2NUZiQ=
  secret: JfQWOVmY0ooY5XUhQsj240IFv51KCBXuTCDqqfV5G7o=

  controlPlane:
    endpoint: https://172.16.0.3:6443
  clusterName: fran

  network:
    dnsDomain: cluster.local

    podSubnets:
      - 172.28.0.0/16

    serviceSubnets:
      - 172.29.0.0/16
    cni:
      name: none
  coreDNS:
    disabled: true
  token: nv4nb9.uqjpai28nl6mdnuj
  secretboxEncryptionSecret: 949pEkK6Q/5x+eheaz0LHJKTUQV3IwDtuEgDfvn/Edc=

  ca:
    crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJpakNDQVRDZ0F3SUJBZ0lSQUs0Ty9rNUtKdnY1eWExMThKSjBFdDR3Q2dZSUtvWkl6ajBFQXdJd0ZURVQKTUJFR0ExVUVDaE1LYTNWaVpYSnVaWFJsY3pBZUZ3MHlOREV4TWpJd01qVTROVGRhRncwek5ERXhNakF3TWpVNApOVGRhTUJVeEV6QVJCZ05WQkFvVENtdDFZbVZ5Ym1WMFpYTXdXVEFUQmdjcWhrak9QUUlCQmdncWhrak9QUU1CCkJ3TkNBQVJsMG92cm5ycmJVdzBLWktQYytDYVd6bXp6S045MGRnUFdKTCtTejZWRkp6Y2kyZEpjV2Nka1d2Z2oKSGYxZVVreC9GQURGRzE5UHBYdkRRbkhKZFl6d28yRXdYekFPQmdOVkhROEJBZjhFQkFNQ0FvUXdIUVlEVlIwbApCQll3RkFZSUt3WUJCUVVIQXdFR0NDc0dBUVVGQndNQ01BOEdBMVVkRXdFQi93UUZNQU1CQWY4d0hRWURWUjBPCkJCWUVGRHRKWnlhaWF0RnRYR213QkpzMVJkL2IvN2xrTUFvR0NDcUdTTTQ5QkFNQ0EwZ0FNRVVDSVFDL1ZQU3cKS0tQYUVJN1hQcVBZcER5NE02a0tudVFWMThObyt1blo0bUhpK1FJZ0VBOTFReldzak82eExjbDRuWTJoQTd3bgpmK2pSaHI4dFZmdUNPSzRmMHlBPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
    key: LS0tLS1CRUdJTiBFQyBQUklWQVRFIEtFWS0tLS0tCk1IY0NBUUVFSUI2RVVsTjh5YlJtV2I1RFdvQlFVSTM5SFFxeWdubjlsYVpXRUZFZG1rcmVvQW9HQ0NxR1NNNDkKQXdFSG9VUURRZ0FFWmRLTDY1NjYyMU1OQ21TajNQZ21sczVzOHlqZmRIWUQxaVMva3MrbFJTYzNJdG5TWEZuSApaRnI0SXgzOVhsSk1meFFBeFJ0ZlQ2Vjd3MEp4eVhXTThBPT0KLS0tLS1FTkQgRUMgUFJJVkFURSBLRVktLS0tLQo=

  aggregatorCA:
    crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJZRENDQVFXZ0F3SUJBZ0lRVmY4azhXVW96ZzNucW5HVFlRek5MekFLQmdncWhrak9QUVFEQWpBQU1CNFgKRFRJME1URXlNakF5TlRnMU4xb1hEVE0wTVRFeU1EQXlOVGcxTjFvd0FEQlpNQk1HQnlxR1NNNDlBZ0VHQ0NxRwpTTTQ5QXdFSEEwSUFCTjY1T3RucERDSkYvRmF5ckRzQjZ4d1dyU0pYQ0hpeEpsL3E4YnpZVEc5Rk5qZFc3c2NxCkNVaW9SSkora1pnVXN3YnlSdVJLWTZwMWdiWjJzSXJvK1U2allUQmZNQTRHQTFVZER3RUIvd1FFQXdJQ2hEQWQKQmdOVkhTVUVGakFVQmdnckJnRUZCUWNEQVFZSUt3WUJCUVVIQXdJd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZApCZ05WSFE0RUZnUVVDamVpNlFjeTFtcVptVHprTWJPbU5qckdhQkF3Q2dZSUtvWkl6ajBFQXdJRFNRQXdSZ0loCkFPekRnSEZzbHNJZlpJcWdvZUVTNnp3djUyU0lzNkE4MWhId0lqb0pnWVg1QWlFQWpnM3JrbFYvWG81b29Wb0oKQUVIbGphVDFqTkgyQlJhbHNuSGEyRWpQbXJNPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
    key: LS0tLS1CRUdJTiBFQyBQUklWQVRFIEtFWS0tLS0tCk1IY0NBUUVFSUxjOW1DU05Cc1Z2VjJkZlJkaUdGb1lreENoZEY2dE1nUDZjY0FoaUZIMUdvQW9HQ0NxR1NNNDkKQXdFSG9VUURRZ0FFM3JrNjJla01Ja1g4VnJLc093SHJIQmF0SWxjSWVMRW1YK3J4dk5oTWIwVTJOMWJ1eHlvSgpTS2hFa242Um1CU3pCdkpHNUVwanFuV0J0bmF3aXVqNVRnPT0KLS0tLS1FTkQgRUMgUFJJVkFURSBLRVktLS0tLQo=

  serviceAccount:
    key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlKS0FJQkFBS0NBZ0VBdWhLdTFnc0ljMVJOZlVPQStmZUd6dFVuL0I1WlBJeGVjZUhScFYyVENsYzA3b2p1CncwUHVPMUZnNnBjcGQzc251TCtRYWI2T1RKUnF6bFZsc2JYSHVwRXlJdy9FSFRnb2szelZmZURraWdxOXI3TGEKcnF1RWdJM0pYV3Z0NzJBZlVLTThzMXVBQ1N5SjB4T1dXRzdxd1RwT0FwSElKUWFSUG5JWEh1TkpvNVYySTd3UwpyQ0duTlJXN2oxSE5HRTcvaVJpUlVhRzBtT0dSdzlGNWFqSmVaWWk2R3dNQ2ZGNC95TVpiZ0JaYXRDS1ppdDhIClhJMW9YWlFVZ0crUDRQcGx6cVpYV1dNaGg1Q0x4OU9JQmJ6eGpXVnhEL05pdzV5WEtjTTE1WmovYStFQzljL0MKaFVCNHBWUEM4UU1aTzB4T2FDazVIajY0U2E4QUhLM1N4UWRNZ0FwZWtyRXVSZ3BwVm82YmdCdXpvTUlPSEhqdAorZnBqTGVraWxPK0JrOURWeFRzNnBGdVgwZDU0eFY1QnlBSFhOeC84TUxsQ1ZXTW9iMzZORUZXcWpKbnVyTFpnCk5TQm9zVlVZakh6UjJMc29pZVhUdEtxYjdxTm1ST0FNQ0NndE02MGlUM3dMODZKT3NTc2d2QXZvNGVva294QlMKUDRLOUxmTUlZTUlwYSs0QndZaHY0c1hjQXh0TXJKc2pGM2FuY2lFeDRuaHRqN1greVhxQURramdxOHRpbTlyWgpwZGtVbzIya1VtdHVTb3B1c3VpTEFNMFRUMFFRSWthK0NOdlRsNGlwTHIwYTFkdTRybDk2R3BWMUtuRGp3VmdmCnhHbmVydFIvL29ZaDNCS1ZZaFVmOHVtcGRseTllSmlSbk1Scy9HLzMzd1QvVGZEaVR3MjQ3ZC9jWitjQ0F3RUEKQVFLQ0FnQWxUZWVWYkFMV3RGa1F1djdabm9GOWFBaXJLQjUxNENKekxIWE9kSE10U0l5SkloVFVPd05CQ3pDbAo5NFpOdVBnZXR2RXA4aFV2VHpZV2hkSnNqV2dzaEQyTC8vWXVjWHJaRHRieWRLcjg3ZWhYbUVEMWNkZVB1bDFiCmlHN2NaZVlCVWFpeXdLNXJxRzA5VHhqK1E4WjIxTXlkQVVNaUFTNFBXZW8rdkF5Z2FpK1VQSGwxM3cxWnZEQ3QKTEJZMVFHbEV3Qk1xVFlRYWZtYXQzb283K3pzbm1nRE50NDNCQjFnOFZXQTB6c2FDaE1sSnFTc2RxQS83YXR1dApZREIxUjE0dnp2T0dMVFNrckJzS0JlT29XdGdHcEFiRnp1TEhHdGJIZmFhSmtHSHM2K0NmRFhjUEpmektFSC90CnQ5UlFLaDB5RHNtdndaMUswSFh5U2ZzT20wYi9zRnlZaEFSb1VEVnhML1FQTXQvazl5UUNadExyOVl3R1YwUXIKbnB5V29sZUN4YVZvTWtRQWd2NWI5N2NSSndZZmdKdEpXU1EzdTFNeHZGaUVxVWtlQURScnhGQ29CU0JyM0k1Ngpqc2lWaC9sOURqc0NhWGpTT2dGOXFJaXgwMXNpWm9ZN0FvMnJZdkUzbWU5OUdBWnlTRCtpblEwWmFEcVJNU21UCmpCRjNnUDI2ejZadjZkVFY1cGtLdVBXNFFlR1pNRE1LcjAzblQ1cFhMTVZMTVAvQXJTMGU5dVVoWGVPMHd6akQKVVBvVitGMHdsWGFZd21NcHZaQXlhOTdrRGlQMGxscFhucDNENW5nQzRJb1lFQmxlR1FOL3I4M3pTVXpWakpHYgo1c0k1OXRPK2xwWFplVmw0R1NMTVRUTW50RFZ5MWdKQVVMNXdrZGYxV002eDkzS0ZFUUtDQVFFQTk4WTBmWGhtCk5xek9MWk8yVWUwcVRiSDNuTDEvN215ZXdNU0tyVlFkcTlteTBrakxWN2JWK1BwMHZtLzRYMko3aERMWjNTNnkKVG0xa3pVRjQ2dHgya0c0elVERlU3UW1NbGd1OTR3K2N2RC84dHc3ZHJNVFhtNXJFNzJsS2E2ZlpQT1pwZy9GVwpTdXh0ZGw1dDRITmpqWGJidjhyanpIbFN6WWFpL3NHTXhhU0tSMG1yY3hEdktQWHRwMExIRXgxQ0ZaVjdoY2EvCmFpN2MzZXZVMWJQSEE1eG9yYjN2bE12dUc3b1VDSUl4dzU3UXRoOUUyc1lEaVJYcnRkS1BwSUo1YnBHck5qLy8KV21WYmFnaTdrT25hbXI5ODJJUVozS0RURmttTGNCWlNvT3QrTlRGVEhvTXozUy94R3RmVTlRUk9IQWxlR2VZaAphUkRhV2cwSWNMRHRUd0tDQVFFQXdFQVdwUmJXOHlzN3BMYUVnU01jdGV5TWRhMkhka21hSkJjajNWMEpYZVVBCkszMGZUTnlwc1pJMWRsRnFDeGxjdWhHV05wYVhZVWpkVGNrZ2FiTGhnSVZ4ZEcvb0lvZGx6Y0Q1SVFpQnhzWlIKUzE3QUw1a0ZGczJYVWYyQ2tBVXhRWVRDQzM4c0w1cnp4Nk1oWXJSNnRIbXBYN0ZnVXNMSk5RQkdvQzJ1Y0ZWWgpJVFhQMGJ4OVdMVnpoN1pJYUgzVlh2Qi9TOHlBejZYSTVUVEY3SGJYZVdUazZLUERkUDRYWjF0TWVuaDEzTDkxCnFKRnphRzlQOXJkc0lGRFpuMGg5MGhtVVlaZ09abkIzSVRsUzBTZ1RmTGZUV1Y0N1FSMkpranY1VGRnOXNISmEKU3J3WjRGUmptL1puS3MvK2ZxQVhzRFRCcWVqaTlCbVA5dWpzcVBnbDZRS0NBUUFURmJsRlVOak9yVkRVUWVSeApPd3RmSUs0cDdJN0dGcWZEd1YvTktnVi9EeTJ1OU54MHpTaCtIUXlRL3A3cStmTDVvOUVVTUZ5Ym5lRjl6ZVU2CmNmRFAveTBFcUVnYVdmbnlOTVZUa0FoS2w4TW5kb1dzb1J6YVozbHoxM0JjQ25tNUx5WkJlMzFpR0FQMmNoK1UKZ2s3UXZxNytmdW84L2J0YkNWdlVzNlBjTldoUlJXTm5ZWTZLWVNjRkV5ZXlXVGFWNHdXNHNDNWVSMjNMeWphQwpuMjVjNE5kUFNxb0JsQk9ySHhJYjlhdFBuaFFGY3pNaWhzNE82UmxXei9rd2VyeFB2L2lvSFJYV0tLaDU2bUpJCkx6c2ZZRkNGZk9kaER5SXpQVWI0UXovcUZUbUxiMWt2cUh0K05nc2tQaXV4RTd2UWZRZzZobmRjV0dmNU43ZkcKdGxvUkFvSUJBUUM4czJ0R3VlZGNJWGhXa1V2NEVVWFNENUJDeFlRc0I4eURWaTgrelY0dlNtSmpUVm9Xc0pUagpsYlppSDBGdUNZUHBvdStGUDBUeEdYc1hLYTVsOFUzRVA3Yi82Z081T0pzbFhSOXJYQlU5elZUb0hPV1pFcUpiCklvcy8wQXlDWG9aZFgvaXpIaTE1d0tjOXNoSkg5d3hsN3ZEZjI1UEhTQ2dFblBPMXI0RUVBOUlMZGUwNVdjRFMKL0srY2FzQWh5RGxTQ2M5NDBBOHpRZSt4Z3A0dkh1c2EzWHlPR0lmMllwMElOeVlYSS92VUpCMVJ5d3F6WEdicApyRm8yVWdWNWdjYjJIV04yYzdEV3ZkZEF4aXBTMy9wWXRYcCt3cTU0bUl4NisrRVZsb1hlbGkrb0lYOW9vSXh3Ci9tZC9MMDhHYlE4elJtVTg2RGswRFk4d2RLb3VvL3RaQW9JQkFBZUxTNnRyT2FTbUVMNnVtNU5JeWhvRkh3WDIKVzlVRktSYjJleEQ0L0tqL2lkZ1RvSEphanZzNlZ6WEdiTjJmVnpnWmZoemJ2Z0J1aHZrZnI4SDBWOHJieUx0NwpIOGNKaWw1Wno2VTE2V2pEb0VqS0ZwTE1LOWFBSVlnTUxMOG40UERvNXFaVDN1YTJFSW14TTUvMHZhUVdTcFFmCnhwd0REWC9GZE1TNlB3N2szRFpmZ3NFOGxSMno3eEtobzhMQ3I3UjltRHYwVjF5SitJNTQya1FWNmFROXkxUUEKZk5pbG1mKzMycXpsdUIxL0R3SE04dUNJeVFhRUFUem1OWmJMR0ZUc3FGbUkxSzZsTnVSa3FudUozUzgxaDIwOQpNQ25nUmZEaURrVXc2V0xuQ3EzYiszSk04U0EzaWtCNFIyYk9ZZ2lxU3g1KzFGWHNNUkZwYjZjRGlSQT0KLS0tLS1FTkQgUlNBIFBSSVZBVEUgS0VZLS0tLS0K

  apiServer:
    image: registry.k8s.io/kube-apiserver:${KUBERNETES_VERSION}

    certSANs:
      - 127.0.0.1
      - 172.16.0.3
    disablePodSecurityPolicy: true
    auditPolicy:
      apiVersion: audit.k8s.io/v1
      kind: Policy
      rules:
        - level: Metadata

  controllerManager:
    image: registry.k8s.io/kube-controller-manager:${KUBERNETES_VERSION}
    extraArgs:
      bind-address: 0.0.0.0
  proxy:
    disabled: true
    image: registry.k8s.io/kube-proxy:${KUBERNETES_VERSION}
  scheduler:
    image: registry.k8s.io/kube-scheduler:${KUBERNETES_VERSION}
    extraArgs:
      bind-address: 0.0.0.0
  discovery:
    enabled: true
    registries:
      kubernetes:
        disabled: false
      service:
        disabled: false
  etcd:
    ca:
      crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJmVENDQVNPZ0F3SUJBZ0lRTkEzMStxRldXMjlHcXdCbEdTZUY1VEFLQmdncWhrak9QUVFEQWpBUE1RMHcKQ3dZRFZRUUtFd1JsZEdOa01CNFhEVEkwTVRFeU1qQXlOVGcxTjFvWERUTTBNVEV5TURBeU5UZzFOMW93RHpFTgpNQXNHQTFVRUNoTUVaWFJqWkRCWk1CTUdCeXFHU000OUFnRUdDQ3FHU000OUF3RUhBMElBQklweDBORmJ6TS9OClhwZ09IeGFRaFpkVEdPb25zTGYxM1RiL2VTaXBKaHZZUHkzbEdkUFlQZUZobFdjTUJFdkNyQnZGR1AyN0hWTmIKcWVwSStRaUNuNmVqWVRCZk1BNEdBMVVkRHdFQi93UUVBd0lDaERBZEJnTlZIU1VFRmpBVUJnZ3JCZ0VGQlFjRApBUVlJS3dZQkJRVUhBd0l3RHdZRFZSMFRBUUgvQkFVd0F3RUIvekFkQmdOVkhRNEVGZ1FVSUcycnUwWXBmY2JBCkRnNlBHVHU4Ky9PWitwb3dDZ1lJS29aSXpqMEVBd0lEU0FBd1JRSWhBSlFsc2pweEdPVDJGMTNadW9PcXoyaTAKS2FUb09kWTgzRGxQWXR1UGtSVm5BaUE0K2ZObS8zdjdGY3h2WVNiUloyejFPelBvanlBSTRKR05HaWFiamNkNgp3QT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
      key: LS0tLS1CRUdJTiBFQyBQUklWQVRFIEtFWS0tLS0tCk1IY0NBUUVFSUtPa09vVUZUSm1DRm9IUUVhRm52ZWlCM2V6SjFiajhkRExqbC8zVTU3UzhvQW9HQ0NxR1NNNDkKQXdFSG9VUURRZ0FFaW5IUTBWdk16ODFlbUE0ZkZwQ0ZsMU1ZNmlld3QvWGROdjk1S0trbUc5Zy9MZVVaMDlnOQo0V0dWWnd3RVM4S3NHOFVZL2JzZFUxdXA2a2o1Q0lLZnB3PT0KLS0tLS1FTkQgRUMgUFJJVkFURSBLRVktLS0tLQo=
    extraArgs:
      listen-metrics-urls: http://0.0.0.0:2381
    advertisedSubnets:
      - 172.16.3.0/24
